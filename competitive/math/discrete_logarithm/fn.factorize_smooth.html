<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `factorize_smooth` fn in crate `competitive`."><title>factorize_smooth in competitive::math::discrete_logarithm - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="competitive" data-themes="" data-resource-suffix="" data-rustdoc-version="1.94.0-nightly (ba2142a19 2025-12-07)" data-channel="nightly" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-a410ff4d.js"></script><script defer src="../../../static.files/scrape-examples-2bbcccac.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const parser = new DOMParser();
    const parse = s => parser.parseFromString(s, "text/html").body.firstChild;

    const addArchiveLinkSetting = () => {
      const settings = document.querySelector("#settings .settings");
      if (!settings) return;
      if (document.getElementById("generate-hidden-archive-link")) return;

      const checked = localStorage.getItem("generate-hidden-archive-link") === "true";
      const archiveLinkSetting = parse(`<div class="setting-line"><label class="setting-check"><input type="checkbox" id="generate-hidden-archive-link" ${checked ? "checked" : ""} /><span>Generate hidden archive link</span></label></div>`);
      settings.appendChild(archiveLinkSetting);
      document.getElementById("generate-hidden-archive-link").addEventListener("change", e => {
        if (e.target.checked) {
          localStorage.setItem("generate-hidden-archive-link", "true");
        } else {
          localStorage.removeItem("generate-hidden-archive-link");
        }
      });
    };
    addArchiveLinkSetting();
    const settingsMenu = document.querySelector("#settings-menu a");
    settingsMenu?.addEventListener("click", addArchiveLinkSetting);

    const addArchiveLink = () => {
      if (localStorage.getItem("generate-hidden-archive-link") !== "true") return;
      const subHeading = document.querySelector("#main-content .main-heading .sub-heading");
      const itemName = document.querySelector("#main-content .main-heading h1 span")?.textContent;
      const isCompetitive = document.querySelector("#main-content .main-heading .rustdoc-breadcrumbs a")?.textContent?.startsWith("competitive");
      if (!itemName || !isCompetitive) return;
      const archiveLink = parse(`<a class="src" href="https://github.com/search?q=repo%3Ato-omer%2Fcompetitive_archive+${itemName}&type=code">Archives</a>`);
      subHeading.appendChild(archiveLink);
    };
    addArchiveLink();
  });
</script>

</head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">factorize_smooth</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../competitive/index.html">competitive</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In competitive::<wbr>math::<wbr>discrete_<wbr>logarithm</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">competitive</a>::<wbr><a href="../index.html">math</a>::<wbr><a href="index.html">discrete_logarithm</a></div><h1>Function <span class="fn">factorize_<wbr>smooth</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/competitive/math/discrete_logarithm.rs.html#94-110">Source</a> </span></div><pre class="rust item-decl"><code>fn factorize_smooth(
    x: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>,
    row: &amp;mut [<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>],
    br_primes: &amp;[<a class="struct" href="../../num/struct.BarrettReduction.html" title="struct competitive::num::BarrettReduction">BarrettReduction</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>&gt;],
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></code></pre><div class="docblock scraped-example-list"><span></span><h5 id="scraped-examples"><a href="#scraped-examples">Examples found in repository</a><a class="scrape-help" href="../../../scrape-examples-help.html">?</a></h5><div class="scraped-example" data-locs="[[[26,26],&#34;../../../src/competitive/math/discrete_logarithm.rs.html#208&#34;,&#34;line 208&#34;],[[108,108],&#34;../../../src/competitive/math/discrete_logarithm.rs.html#290&#34;,&#34;line 290&#34;]]"><div class="scraped-example-title">crates/competitive/src/math/discrete_logarithm.rs (<a href="../../../src/competitive/math/discrete_logarithm.rs.html#208">line 208</a>)</div><div class="example-wrap digits-3"><pre class="rust"><code><span data-nosnippet>182</span><span class="kw">fn </span>index_calculus_for_primitive_root(
<span data-nosnippet>183</span>    p: u64,
<span data-nosnippet>184</span>    ord: u64,
<span data-nosnippet>185</span>    br_primes: <span class="kw-2">&amp;</span>[BarrettReduction&lt;u64&gt;],
<span data-nosnippet>186</span>    prec: <span class="kw-2">&amp;</span>QdrtPowPrec,
<span data-nosnippet>187</span>) -&gt; Vec&lt;u64&gt; {
<span data-nosnippet>188</span>    <span class="kw">let </span>br_ord = BarrettReduction::&lt;u128&gt;::new(ord <span class="kw">as </span>u128);
<span data-nosnippet>189</span>    <span class="kw">let </span>mul = |x: u64, y: u64| br_ord.rem(x <span class="kw">as </span>u128 * y <span class="kw">as </span>u128) <span class="kw">as </span>u64;
<span data-nosnippet>190</span>    <span class="kw">let </span>sub = |x: u64, y: u64| <span class="kw">if </span>x &lt; y { x + ord - y } <span class="kw">else </span>{ x - y };
<span data-nosnippet>191</span>
<span data-nosnippet>192</span>    <span class="kw">let </span>pc = br_primes.len();
<span data-nosnippet>193</span>    <span class="kw">let </span><span class="kw-2">mut </span>mat: Vec&lt;Vec&lt;u64&gt;&gt; = <span class="macro">vec!</span>[];
<span data-nosnippet>194</span>    <span class="kw">let </span><span class="kw-2">mut </span>rows: Vec&lt;Vec&lt;u64&gt;&gt; = <span class="macro">vec!</span>[];
<span data-nosnippet>195</span>
<span data-nosnippet>196</span>    <span class="kw">let </span><span class="kw-2">mut </span>rng = Xorshift::default();
<span data-nosnippet>197</span>    <span class="kw">let </span>br = BarrettReduction::&lt;u128&gt;::new(p <span class="kw">as </span>u128);
<span data-nosnippet>198</span>
<span data-nosnippet>199</span>    <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..pc {
<span data-nosnippet>200</span>        <span class="kw">for </span>ri <span class="kw">in </span><span class="number">0usize</span>.. {
<span data-nosnippet>201</span>            <span class="kw">let </span><span class="kw-2">mut </span>row = <span class="macro">vec!</span>[<span class="number">0u64</span>; pc + <span class="number">1</span>];
<span data-nosnippet>202</span>            <span class="kw">let </span><span class="kw-2">mut </span>kk = rng.rand(ord - <span class="number">1</span>) + <span class="number">1</span>;
<span data-nosnippet>203</span>            <span class="kw">let </span><span class="kw-2">mut </span>gkk = prec.pow(kk, <span class="kw-2">&amp;</span>br);
<span data-nosnippet>204</span>            <span class="kw">let </span><span class="kw-2">mut </span>k = kk;
<span data-nosnippet>205</span>            <span class="kw">let </span><span class="kw-2">mut </span>gk = gkk;
<span data-nosnippet>206</span>            <span class="kw">while </span>ri &gt;= rows.len() {
<span data-nosnippet>207</span>                row[pc] = k;
<span data-nosnippet>208</span>                <span class="kw">if </span><span class="highlight focus">factorize_smooth</span>(gk, <span class="kw-2">&amp;mut </span>row, br_primes) {
<span data-nosnippet>209</span>                    rows.push(row);
<span data-nosnippet>210</span>                    <span class="kw">break</span>;
<span data-nosnippet>211</span>                }
<span data-nosnippet>212</span>                <span class="kw">if </span>k + kk &lt; ord {
<span data-nosnippet>213</span>                    k += kk;
<span data-nosnippet>214</span>                    gk = br.rem(gk <span class="kw">as </span>u128 * gkk <span class="kw">as </span>u128) <span class="kw">as </span>u64;
<span data-nosnippet>215</span>                } <span class="kw">else </span>{
<span data-nosnippet>216</span>                    kk = rng.rand(ord - <span class="number">1</span>) + <span class="number">1</span>;
<span data-nosnippet>217</span>                    gkk = prec.pow(kk, <span class="kw-2">&amp;</span>br);
<span data-nosnippet>218</span>                    k = kk;
<span data-nosnippet>219</span>                    gk = gkk;
<span data-nosnippet>220</span>                }
<span data-nosnippet>221</span>            }
<span data-nosnippet>222</span>            <span class="kw">let </span>row = <span class="kw-2">&amp;mut </span>rows[ri];
<span data-nosnippet>223</span>            <span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..i {
<span data-nosnippet>224</span>                <span class="kw">if </span>row[j] != <span class="number">0 </span>{
<span data-nosnippet>225</span>                    <span class="kw">let </span>b = mul(modinv(mat[j][j], ord), row[j]);
<span data-nosnippet>226</span>                    <span class="kw">for </span>(r, a) <span class="kw">in </span>row[j..].iter_mut().zip(<span class="kw-2">&amp;</span>mat[j][j..]) {
<span data-nosnippet>227</span>                        <span class="kw-2">*</span>r = sub(<span class="kw-2">*</span>r, mul(<span class="kw-2">*</span>a, b));
<span data-nosnippet>228</span>                    }
<span data-nosnippet>229</span>                }
<span data-nosnippet>230</span>                <span class="macro">assert_eq!</span>(row[j], <span class="number">0</span>);
<span data-nosnippet>231</span>            }
<span data-nosnippet>232</span>            <span class="kw">if </span>gcd(row[i], ord) == <span class="number">1 </span>{
<span data-nosnippet>233</span>                <span class="kw">let </span>last = rows.len() - <span class="number">1</span>;
<span data-nosnippet>234</span>                rows.swap(ri, last);
<span data-nosnippet>235</span>                mat.push(rows.pop().unwrap());
<span data-nosnippet>236</span>                <span class="kw">break</span>;
<span data-nosnippet>237</span>            }
<span data-nosnippet>238</span>        }
<span data-nosnippet>239</span>    }
<span data-nosnippet>240</span>    <span class="kw">for </span>i <span class="kw">in </span>(<span class="number">0</span>..pc).rev() {
<span data-nosnippet>241</span>        <span class="kw">for </span>j <span class="kw">in </span>i + <span class="number">1</span>..pc {
<span data-nosnippet>242</span>            mat[i][pc] = sub(mat[i][pc], mul(mat[i][j], mat[j][pc]));
<span data-nosnippet>243</span>        }
<span data-nosnippet>244</span>        mat[i][pc] = mul(mat[<a href="#151">i</a>][pc], modinv(mat[i][<a href="#151">i</a>], ord));
<span data-nosnippet>245</span>    }
<span data-nosnippet>246</span>    (<span class="number">0</span>..pc).map(|i| mat[i][pc]).collect()
<span data-nosnippet>247</span>}
<span data-nosnippet>248</span>
<span data-nosnippet>249</span><span class="attr">#[derive(Debug)]
<span data-nosnippet>250</span></span><span class="kw">struct </span>IndexCalculusWithPrimitiveRoot {
<span data-nosnippet>251</span>    p: u64,
<span data-nosnippet>252</span>    ord: u64,
<span data-nosnippet>253</span>    prec: QdrtPowPrec,
<span data-nosnippet>254</span>    coeff: Vec&lt;u64&gt;,
<span data-nosnippet>255</span>}
<span data-nosnippet>256</span>
<span data-nosnippet>257</span><span class="kw">impl </span>IndexCalculusWithPrimitiveRoot {
<span data-nosnippet>258</span>    <span class="kw">fn </span>new(p: u64, br_primes: <span class="kw-2">&amp;</span>[BarrettReduction&lt;u64&gt;]) -&gt; <span class="self">Self </span>{
<span data-nosnippet>259</span>        <span class="kw">let </span>ord = p - <span class="number">1</span>;
<span data-nosnippet>260</span>        <span class="kw">let </span>g = primitive_root(p);
<span data-nosnippet>261</span>        <span class="kw">let </span>br = BarrettReduction::&lt;u128&gt;::new(p <span class="kw">as </span>u128);
<span data-nosnippet>262</span>        <span class="kw">let </span>prec = QdrtPowPrec::new(g, ord, <span class="kw-2">&amp;</span>br);
<span data-nosnippet>263</span>        <span class="kw">let </span>coeff = index_calculus_for_primitive_root(p, ord, br_primes, <span class="kw-2">&amp;</span>prec);
<span data-nosnippet>264</span>        <span class="self">Self </span>{
<span data-nosnippet>265</span>            p,
<span data-nosnippet>266</span>            ord,
<span data-nosnippet>267</span>            prec,
<span data-nosnippet>268</span>            coeff,
<span data-nosnippet>269</span>        }
<span data-nosnippet>270</span>    }
<span data-nosnippet>271</span>    <span class="kw">fn </span>index_calculus(<span class="kw-2">&amp;</span><span class="self">self</span>, a: u64, br_primes: <span class="kw-2">&amp;</span>[BarrettReduction&lt;u64&gt;]) -&gt; <span class="prelude-ty">Option</span>&lt;u64&gt; {
<span data-nosnippet>272</span>        <span class="kw">let </span>p = <span class="self">self</span>.p;
<span data-nosnippet>273</span>        <span class="kw">let </span>ord = <span class="self">self</span>.ord;
<span data-nosnippet>274</span>        <span class="kw">let </span>br = BarrettReduction::&lt;u128&gt;::new(p <span class="kw">as </span>u128);
<span data-nosnippet>275</span>        <span class="kw">let </span>a = br.rem(a <span class="kw">as _</span>) <span class="kw">as </span>u64;
<span data-nosnippet>276</span>        <span class="kw">if </span>a == <span class="number">1 </span>{
<span data-nosnippet>277</span>            <span class="kw">return </span><span class="prelude-val">Some</span>(<span class="number">0</span>);
<span data-nosnippet>278</span>        }
<span data-nosnippet>279</span>        <span class="kw">if </span>p == <span class="number">2 </span>{
<span data-nosnippet>280</span>            <span class="kw">return </span><span class="prelude-val">None</span>;
<span data-nosnippet>281</span>        }
<span data-nosnippet>282</span>
<span data-nosnippet>283</span>        <span class="kw">let </span><span class="kw-2">mut </span>rng = Xorshift::new();
<span data-nosnippet>284</span>        <span class="kw">let </span><span class="kw-2">mut </span>row = <span class="macro">vec!</span>[<span class="number">0u64</span>; br_primes.len()];
<span data-nosnippet>285</span>        <span class="kw">let </span><span class="kw-2">mut </span>kk = rng.rand(ord - <span class="number">1</span>) + <span class="number">1</span>;
<span data-nosnippet>286</span>        <span class="kw">let </span><span class="kw-2">mut </span>gkk = <span class="self">self</span>.prec.pow(kk, <span class="kw-2">&amp;</span>br);
<span data-nosnippet>287</span>        <span class="kw">let </span><span class="kw-2">mut </span>k = kk;
<span data-nosnippet>288</span>        <span class="kw">let </span><span class="kw-2">mut </span>gk = br.rem(gkk <span class="kw">as </span>u128 * a <span class="kw">as </span>u128) <span class="kw">as </span>u64;
<span data-nosnippet>289</span>        <span class="kw">loop </span>{
<span data-nosnippet>290</span>            <span class="kw">if </span><span class="highlight">factorize_smooth</span>(gk, <span class="kw-2">&amp;mut </span>row, br_primes) {
<span data-nosnippet>291</span>                <span class="kw">let </span><span class="kw-2">mut </span>res = ord - k;
<span data-nosnippet>292</span>                <span class="kw">for </span>(<span class="kw-2">&amp;</span>c, <span class="kw-2">&amp;</span>r) <span class="kw">in </span><span class="self">self</span>.coeff.iter().zip(<span class="kw-2">&amp;</span>row) {
<span data-nosnippet>293</span>                    <span class="kw">for _ in </span><span class="number">0</span>..r {
<span data-nosnippet>294</span>                        res += c;
<span data-nosnippet>295</span>                        <span class="kw">if </span>res &gt;= ord {
<span data-nosnippet>296</span>                            res -= ord;
<span data-nosnippet>297</span>                        }
<span data-nosnippet>298</span>                    }
<span data-nosnippet>299</span>                }
<span data-nosnippet>300</span>                <span class="kw">return </span><span class="prelude-val">Some</span>(res);
<span data-nosnippet>301</span>            }
<span data-nosnippet>302</span>            <span class="kw">if </span>k + kk &lt; ord {
<span data-nosnippet>303</span>                k += kk;
<span data-nosnippet>304</span>                gk = br.rem(gk <span class="kw">as </span>u128 * gkk <span class="kw">as </span>u128) <span class="kw">as </span>u64;
<span data-nosnippet>305</span>            } <span class="kw">else </span>{
<span data-nosnippet>306</span>                kk = rng.rand(ord - <span class="number">1</span>) + <span class="number">1</span>;
<span data-nosnippet>307</span>                gkk = <span class="self">self</span>.prec.pow(kk, <span class="kw-2">&amp;</span>br);
<span data-nosnippet>308</span>                k = kk;
<span data-nosnippet>309</span>                gk = br.rem(gkk <span class="kw">as </span>u128 * a <span class="kw">as </span>u128) <span class="kw">as </span>u64;
<span data-nosnippet>310</span>            }
<span data-nosnippet>311</span>        }
<span data-nosnippet>312</span>    }</code></pre></div></div></div></section></div></main></body></html>